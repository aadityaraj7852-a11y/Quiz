<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>MCQ Generator → DOCX</title>

  <!-- Working DOCX libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.1.4/pizzip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.1.4/pizzip-utils.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.29.2/docxtemplater.js"></script>

  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family: Arial; margin:12px}
    .wrap{display:flex; gap:12px; flex-wrap:wrap}
    .col{background:#fff;border:1px solid #ddd;padding:12px;border-radius:6px}
    input,textarea,select{width:100%;padding:8px;margin:4px 0}
    button{padding:10px 16px; margin-top:10px; background:#0066cc; color:white; border:0; border-radius:6px}
    .right{max-height:80vh; overflow:auto}
  </style>
</head>
<body>

<h2>MCQ Generator → DOCX (Working Without Errors)</h2>

<div class="wrap">

  <!-- LEFT SIDE -->
  <div class="col" style="flex:1;min-width:320px">
    <label>Module</label>
    <input id="module">

    <label>Question</label>
    <textarea id="question"></textarea>

    <label>Options</label>
    <input id="A" placeholder="Option A">
    <input id="B" placeholder="Option B">
    <input id="C" placeholder="Option C">
    <input id="D" placeholder="Option D">

    <label>Answer (A/B/C/D)</label>
    <input id="answer">

    <label>Solution</label>
    <textarea id="solution"></textarea>

    <label>Positive Marks</label>
    <input id="pm" value="1">

    <label>Negative Marks</label>
    <input id="nm" value="0">

    <label>Language</label>
    <select id="language">
      <option value="hi">hi</option>
      <option value="en">en</option>
    </select>

    <button onclick="addQ()">Add Question</button>
    <button onclick="exportDOCX()" style="background:#0b7a3e">Export DOCX</button>
  </div>

  <!-- RIGHT SIDE -->
  <div class="col right" style="flex:1;min-width:320px">
    <h3>Preview</h3>
    <div id="preview"></div>
  </div>

</div>

<script>
let arr = [];
let qno = 1;

function addQ(){
  const q = {
    section: document.getElementById("module").value,
    qno,
    question: document.getElementById("question").value,
    type: "mcq",
    A: document.getElementById("A").value,
    B: document.getElementById("B").value,
    C: document.getElementById("C").value,
    D: document.getElementById("D").value,
    answer: document.getElementById("answer").value,
    solution: document.getElementById("solution").value,
    pm: document.getElementById("pm").value,
    nm: document.getElementById("nm").value,
    language: document.getElementById("language").value
  };

  arr.push(q);
  qno++;

  render();
}

function render(){
  let html = "";
  arr.forEach(q=>{
    html += `<p><b>${q.qno})</b> ${q.question}</p>`;
  });
  document.getElementById("preview").innerHTML = html;
}

function exportDOCX(){
  PizZipUtils.getBinaryContent("MCQ_Template.docx", function(error, content){
    if (error){ alert("Template नहीं मिली!"); return; }

    const zip = new PizZip(content);
    const doc = new window.docxtemplater(zip);

    doc.setData({ questions: arr });

    try { doc.render(); }
    catch(e){ alert(e.message); }

    const out = doc.getZip().generate({ type: "blob" });

    const a = document.createElement("a");
    a.href = URL.createObjectURL(out);
    a.download = "MCQ_Export.docx";
    a.click();
  });
}
</script>

</body>
</html>
